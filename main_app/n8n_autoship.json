{
    "name": "ERP+ Auto-Ship & Smart Restock (V30 Connection Fix)",
    "nodes": [
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "order-status-changed",
                "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                250,
                300
            ],
            "id": "webhook-trigger",
            "name": "Webhook: Order Status Changed"
        },
        {
            "parameters": {
                "rule": {
                    "interval": [
                        {
                            "field": "minutes",
                            "minutesInterval": 5
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.1,
            "position": [
                250,
                500
            ],
            "id": "cron-trigger",
            "name": "Schedule: Every 5 Minutes"
        },
        {
            "parameters": {
                "conditions": {
                    "string": [
                        {
                            "value1": "={{$json.body.data.status}}",
                            "operation": "equal",
                            "value2": "Paid"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 1,
            "position": [
                450,
                300
            ],
            "id": "check-paid-webhook",
            "name": "Is Paid? (Webhook)"
        },
        {
            "parameters": {
                "method": "GET",
                "url": "={{ 'http://host.docker.internal/109022005bootstrap/main_app/api/orders_api.php?api_key=erp_n8n_secret_88d4f20&action=update_status&status=Shipped&id=' + ($json.body.entity_id || $json.id) }}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                650,
                200
            ],
            "id": "ship-webhook-order",
            "name": "Ship Order (Webhook)"
        },
        {
            "parameters": {
                "method": "GET",
                "url": "http://host.docker.internal/109022005bootstrap/main_app/api/orders_api.php?api_key=erp_n8n_secret_88d4f20",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                450,
                500
            ],
            "id": "fetch-all-orders",
            "name": "Get All Orders"
        },
        {
            "parameters": {
                "conditions": {
                    "string": [
                        {
                            "value1": "={{$json.status}}",
                            "operation": "equal",
                            "value2": "Paid"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.filter",
            "typeVersion": 1,
            "position": [
                650,
                500
            ],
            "id": "filter-paid-orders",
            "name": "Filter Paid Orders"
        },
        {
            "parameters": {
                "method": "GET",
                "url": "={{ 'http://host.docker.internal/109022005bootstrap/main_app/api/orders_api.php?api_key=erp_n8n_secret_88d4f20&action=update_status&status=Shipped&id=' + $json.id }}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                850,
                500
            ],
            "id": "ship-cron-order",
            "name": "Ship Order (Cron)"
        },
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "restock-trigger",
                "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                250,
                800
            ],
            "id": "webhook-restock",
            "name": "Webhook: Restock Request"
        },
        {
            "parameters": {
                "method": "GET",
                "url": "={{ 'http://host.docker.internal/109022005bootstrap/main_app/api/v1/inventory/inbound?api_key=erp_n8n_secret_88d4f20&product_id=' + $json.body.entity_id + '&quantity=' + $json.body.data.suggested_qty + '&reason=AUTO_RESTOCK_V30' }}",
                "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                600,
                800
            ],
            "id": "api-restock-inbound",
            "name": "Restock Action (Connected)"
        },
        {
            "parameters": {
                "content": "## ğŸš€ ERP+ V30 é€£ç·šä¿®å¾©ç‰ˆ\n\n**ä¿®æ­£é‡é»ï¼š**\n1. **ä¿®å¾©æ–·ç·šå•é¡Œ**ï¼šä¿®æ­£äº† n8n JSON ä¸­ç¯€é»åç¨±å°æ‡‰éŒ¯èª¤ï¼Œè§£æ±ºã€ŒåŸ·è¡ŒæˆåŠŸä½†ç„¡åæ‡‰ã€çš„å•é¡Œã€‚\n2. **Host Docker Internal**ï¼šé è¨­ä½¿ç”¨ docker æŒ‡å‘ï¼Œå¦‚æœéœ€è¦ localhost è«‹æ‰‹å‹•ä¿®æ”¹ã€‚\n\n**åŒ¯å…¥å¾Œè«‹ç¢ºèªç¯€é»ä¹‹é–“æœ‰é€£ç·šï¼**",
                "height": 380,
                "width": 380
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
                180,
                -150
            ],
            "id": "note-v30",
            "name": "V30 èªªæ˜"
        }
    ],
    "connections": {
        "Webhook: Order Status Changed": {
            "main": [
                [
                    {
                        "node": "Is Paid? (Webhook)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Schedule: Every 5 Minutes": {
            "main": [
                [
                    {
                        "node": "Get All Orders",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Is Paid? (Webhook)": {
            "main": [
                [
                    {
                        "node": "Ship Order (Webhook)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Get All Orders": {
            "main": [
                [
                    {
                        "node": "Filter Paid Orders",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Filter Paid Orders": {
            "main": [
                [
                    {
                        "node": "Ship Order (Cron)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Webhook: Restock Request": {
            "main": [
                [
                    {
                        "node": "Restock Action (Connected)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "settings": {
        "executionOrder": "v1"
    }
}